<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Inventaris Masjid Al-Falah</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #fff8e1;
  color: #4e342e;
}

/* HEADER */
header {
  background: linear-gradient(90deg, #f9a825, #6d4c41);
  padding: 25px;
  color: white;
}

.header-content {
  display: flex;
  align-items: center;
  gap: 25px;
}

/* LOGO */
.logo {
  width: 120px;
  height: 120px;
  background: white;
  border-radius: 50%;
  padding: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

/* NAVBAR */
nav {
  margin-top: 20px;
}

nav a {
  color: #fffde7;
  text-decoration: none;
  margin-right: 18px;
  font-weight: 600;
}

nav a:hover {
  text-decoration: underline;
}

/* LOGOUT */
.logout {
  float: right;
  background: #fffde7;
  color: #6d4c41;
  padding: 6px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

/* CONTAINER */
.container {
  padding: 25px;
  max-width: 1150px;
  margin: auto;
}

/* CARD */
.card {
  background: #fff;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  margin-bottom: 25px;
}

/* TOTAL */
.total {
  font-size: 42px;
  color: #f9a825;
  margin: 0;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th {
  background: #f9a825;
  color: #4e342e;
  padding: 12px;
}

td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #ddd;
}

tr:hover {
  background: #fffde7;
}

/* DESKRIPSI */
.deskripsi p {
  line-height: 1.8;
  text-align: justify;
}

/* GRAFIK */
canvas {
  max-width: 100%;
  height: 350px;
}
</style>
</head>

<body>

<!-- ðŸ” CEK LOGIN -->
<script>
if (localStorage.getItem("login") !== "true") {
  window.location.href = "login.html";
}
</script>

<header>
  <div class="header-content">
    <img src="logo.jpeg" class="logo" alt="Logo Masjid Al-Falah">
    <div>
      <h1>Dashboard Inventaris Masjid Al-Falah</h1>
      <p>Sistem Informasi Inventaris & Kegiatan Masjid</p>
    </div>
  </div>

  <nav>
    <a href="#">Dashboard</a>
    <a href="#deskripsi">Tentang Masjid</a>
    <a href="#inventaris">Inventaris</a>
    <span class="logout" onclick="logout()">Logout</span>
  </nav>
</header>

<div class="container">

  <!-- DESKRIPSI -->
  <div class="card deskripsi" id="deskripsi">
    <h2>Tentang Masjid Al-Falah</h2>
    <p>
      Masjid Al-Falah merupakan salah satu masjid yang aktif dalam menghidupkan kegiatan keagamaan dan sosial di tengah masyarakat. Dengan berlokasikan di Bandung no.9, Jalan Sariasih 3, 40151, Bandung Jawa Barat. Masjid ini menjadi pusat ibadah sekaligus tempat berkumpulnya warga untuk mempererat silaturahmi. Suasana masjid yang tenang dan fasilitas yang memadai membuat jamaah merasa nyaman dalam beribadah maupun mengikuti kegiatan lainnya.
    </p>
    <p>
      Melalui website resminya masjid Al-Falah menyediakan berbagai informasi penting mengenai inventarist yang ada di mesjid AL-Falah. Di mana dari website ini jamaah mesjid dan mengetahui inventaris yang ada di mesjid Al-Falah.
    </p>
    <p>
      Kegiatan yang rutin dilaksanakan di Masjid Al-Falah meliputi pengajian mingguan, kelas tahfidz, serta kegiatan sosial seperti santunan anak yatim dan bantuan untuk masyarakat kurang mampu. Pada bulan Ramadan, masjid ini semakin ramai dengan kegiatan buka puasa bersama, tarawih berjamaah, dan pesantren kilat untuk anak-anak.
    </p>
    <p>
      Dengan berbagai aktivitas tersebut, Masjid Al-Falah tidak hanya berperan sebagai tempat ibadah, tetapi juga sebagai pusat pembinaan umat dan wadah kebersamaan. Kehadirannya menjadi simbol semangat kebersamaan, dakwah, dan pelayanan sosial yang terus berkembang seiring dengan kebutuhan masyarakat.
    </p>
  </div>

  <!-- TOTAL -->
  <div class="card">
    <h3>Total Jumlah Inventaris</h3>
    <p class="total" id="total">0</p>
  </div>

  <!-- GRAFIK -->
  <div class="card">
    <h3>Grafik Jumlah Inventaris</h3>
    <canvas id="grafik"></canvas>
  </div>

  <!-- TABEL -->
  <div class="card" id="inventaris">
    <h3>Data Inventaris Masjid</h3>
    <table id="tabel">
      <tr>
        <th>Tanggal</th>
        <th>Nama Perabot</th>
        <th>Jumlah</th>
        <th>Kondisi</th>
      </tr>
    </table>
  </div>

</div>

<script>
function logout() {
  localStorage.removeItem("login");
  window.location.href = "login.html";
}

document.addEventListener("DOMContentLoaded", function () {

  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4KHkq3bFj27S1xiW-bJuTZZfycMQUR3ryo8N1vWR2da8PKhv370nAZbO-zhKXZBXpduooaxOWNOR6/pub?gid=2102583138&single=true&output=csv";

  fetch(url)
    .then(res => res.text())
    .then(text => {

      function parseCSV(text) {
        const rows = [];
        let row = [];
        let cell = "";
        let insideQuotes = false;

        for (let i = 0; i < text.length; i++) {
          const char = text[i];

          if (char === '"') {
            insideQuotes = !insideQuotes;
          } else if (char === ',' && !insideQuotes) {
            row.push(cell.trim());
            cell = "";
          } else if (char === '\n' && !insideQuotes) {
            row.push(cell.trim());
            rows.push(row);
            row = [];
            cell = "";
          } else {
            cell += char;
          }
        }
        if (row.length) {
          row.push(cell.trim());
          rows.push(row);
        }
        return rows;
      }

      const rows = parseCSV(text);
      const table = document.getElementById("tabel");

      let total = 0;
      let map = {};

      for (let i = 1; i < rows.length; i++) {
        const [tanggal, nama, jumlahRaw, kondisi] = rows[i];
        if (!tanggal || !nama) continue;

        const jumlah = parseInt((jumlahRaw || "").replace(/\D/g, "")) || 0;

        const tr = table.insertRow();
        tr.insertCell(0).innerText = tanggal;
        tr.insertCell(1).innerText = nama;
        tr.insertCell(2).innerText = jumlah;
        tr.insertCell(3).innerText = kondisi || "-";

        total += jumlah;
        map[nama] = (map[nama] || 0) + jumlah;
      }

      document.getElementById("total").innerText = total;

      new Chart(document.getElementById("grafik"), {
        type: "bar",
        data: {
          labels: Object.keys(map),
          datasets: [{
            label: "Jumlah Inventaris",
            data: Object.values(map),
            backgroundColor: "#f9a825"
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });

    })
    .catch(err => console.error(err));
});
</script>

</body>
</html>
